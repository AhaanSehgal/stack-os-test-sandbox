import { useEffect, useState } from 'react';
import { parseEventData } from './useTriaConnector';
import { eventTypes } from '../utils/constants';

export function useLogout({ authUrl }: any) {
  const [success, setSuccess] = useState(false);

  useEffect(() => {
    const authResponse = (event: any) => {
      try {
        if (event.origin !== authUrl) return;
        const eventData = parseEventData(event);
        if (eventData.type == eventTypes.logout) {
          console.log('Logged out!');
          setSuccess(true);
          window.parent.postMessage(event.data, document.referrer);
        }
      } catch (err) {
        setSuccess(false);
      }
    };
    window.addEventListener('message', authResponse);
    return () => {
      window.removeEventListener('message', authResponse);
    };
  }, []);

  return { success };
}
