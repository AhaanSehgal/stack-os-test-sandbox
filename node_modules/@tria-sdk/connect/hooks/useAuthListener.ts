import { useEffect } from 'react';
import { eventTypes } from '../utils/constants';

/**
 * To be used in wallet.tria.so
 */
export function useAuthListener({ authUrl = 'https://auth.tria.so' }: { authUrl: string }) {
  useEffect(() => {
    const listen = (event: any) => {
      if (event.origin !== authUrl) return;
      let eventData;
      try {
        eventData = JSON.parse(event.data);
      } catch (err) {}
      if (eventData.type == eventTypes.accessToken) {
        localStorage.setItem('tria.accessToken', eventData?.data);
        console.log('Access token set to wallet local storage');
      }
    };
    window.addEventListener('message', listen);

    return () => {
      window.removeEventListener('message', listen);
    };
  }, []);
}
