import { useEffect, useState } from 'react';

export function useSocialConnect() {
  const [success, setSuccess] = useState(false);
  const channel = new BroadcastChannel('Tria Auth Channel');

  useEffect(() => {
    const authResponse = (event: any) => {
      try {
        if (event.origin !== window.origin) return;
        window.parent.postMessage(event.data, document.referrer);
        // for unity postMessage to webview
        // window.vuplex.webview
        // console.log('POST MESSAGE DONE on auth invis iframe', event);
        setSuccess(true);
      } catch (err) {
        setSuccess(false);
      }
    };
    channel.onmessage = authResponse;
    window.addEventListener('message', authResponse);
    return () => {
      channel.removeEventListener('message', authResponse);
      window.removeEventListener('message', authResponse);
    };
  }, []);

  return { success };
}
