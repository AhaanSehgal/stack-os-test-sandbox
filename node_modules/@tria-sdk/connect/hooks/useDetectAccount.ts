import { useEffect, useState } from 'react';
import { eventTypes } from '../utils/constants';

export function useDetectAccount({ authUrl }: { authUrl: string }) {
  const [account, setAccount] = useState(null);
  useEffect(() => {
    const detect = (event: any) => {
      if (event.origin !== authUrl) return;
      let eventData;
      try {
        eventData = JSON.parse(event.data);
      } catch (err) {
        eventData = event.data;
      }
      if (eventData?.type == eventTypes.detected) {
        setAccount(eventData?.data);
      }
    };
    window.addEventListener('message', detect);

    return () => {
      window.removeEventListener('message', detect);
    };
  }, []);

  return { account };
}
